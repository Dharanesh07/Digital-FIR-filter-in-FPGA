`timescale 1us / 1ns

module fifo_tb ();
  // Parameters for the FIFO
  parameter WIDTH = 8;
  parameter DEPTH = 15;

  // Signals
  reg clk;
  reg rst;
  reg write_en;
  reg read_en;
  reg [WIDTH-1:0] data_in;
  wire [WIDTH-1:0] data_out;
  wire full;
  wire empty;
  wire overflow;
  wire underflow;

  // Array to hold expected data for comparison
  reg [WIDTH-1:0] wdata_q[0:DEPTH-1];
  reg [WIDTH-1:0] wdata;
  integer i, j;
  integer write_index = 0;
  integer read_index = 0;

  // Instantiate the FIFO
  fifo #(
      .WIDTH(WIDTH),
      .DEPTH(DEPTH)
  ) uut (
      .i_clk    (clk),
      .i_rst    (rst),
      .i_wren   (write_en),
      .i_rden   (read_en),
      .i_datain (data_in),
      .o_dataout(data_out),
      .full     (full),
      .empty    (empty),
      .overflow (overflow),
      .underflow(underflow)
  );

  // Clock generation
  initial begin
    clk = 0;
    forever #5 clk = ~clk;  // 10ns clock period
  end

  // Test procedure
  initial begin
    // Initialize signals
    rst      = 1;
    write_en = 0;
    read_en  = 0;
    data_in  = 8'b0;

    // Reset the FIFO
    #10 rst = 0;
    #10 rst = 1;  // Release reset
    #10 rst = 0;

    // Test: Fill the FIFO to its full capacity
    $display("Filling FIFO...");
    for (i = 0; i < DEPTH; i = i + 1) begin
      @(posedge clk);
      if (!full) begin
        write_en = 1;
        data_in = $urandom % 256;
        wdata_q[i] = data_in;
      end
      #10 write_en = 0;
    end

    // Check if FIFO is full
    if (full) $display("FIFO is full as expected.");

    $display("Emptying FIFO...");
    for (j = 0; j < DEPTH; j = j + 1) begin

      @(posedge clk);
      if (!empty) begin
        read_en = 1;
        wdata   = wdata_q[j];
        if (data_out !== wdata) begin
          $display("Comparison Failed at time %0t: Expected %h, Got %h", $time, wdata, data_out);
        end else begin
          $display("Comparison Passed at time %0t: Expected %h, Got %h", $time, wdata, data_out);
        end
      if (empty) $display("FIFO is empty as expected.");
    end
  end
end

  initial begin
    // VCD dump for waveform analysis
    $dumpfile("fifo_tb.vcd");
    $dumpvars(0, fifo_tb);
    #10000;  // Duration for simulation
    $finish;
  end
endmodule
